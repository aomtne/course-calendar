<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>èª²ç¨‹æœˆæ›†</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=DM+Mono:wght@400;500&display=swap');

  :root {
    --bg: #0f1117;
    --surface: #1a1d27;
    --surface2: #22263a;
    --border: #2e3348;
    --accent: #4f8ef7;
    --accent2: #7c3aed;
    --green: #22c55e;
    --yellow: #f59e0b;
    --red: #ef4444;
    --text: #e2e8f0;
    --text2: #94a3b8;
    --text3: #475569;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans TC', sans-serif;
    min-height: 100vh;
    padding: 24px 16px;
  }

  /* èƒŒæ™¯è£é£¾ */
  body::before {
    content: '';
    position: fixed;
    top: -200px; left: -200px;
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(79,142,247,0.08) 0%, transparent 70%);
    pointer-events: none;
  }

  .container { max-width: 960px; margin: 0 auto; }

  h1 {
    font-size: 1.6rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    background: linear-gradient(135deg, #4f8ef7, #a78bfa);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
  }

  .subtitle { color: var(--text2); font-size: 0.85rem; margin-bottom: 28px; }

  /* æœå°‹å€ */
  .search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 28px;
    flex-wrap: wrap;
  }

  .search-box input {
    flex: 1;
    min-width: 200px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 12px 16px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .search-box input:focus { border-color: var(--accent); }
  .search-box input::placeholder { color: var(--text3); }

  .btn {
    padding: 12px 24px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-family: 'Noto Sans TC', sans-serif;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
  }
  .btn-primary:hover { opacity: 0.85; transform: translateY(-1px); }

  .btn-all {
    background: var(--surface2);
    color: var(--text2);
    border: 1px solid var(--border);
  }
  .btn-all:hover { border-color: var(--accent); color: var(--accent); }

  /* ä½¿ç”¨è€…è³‡è¨Šåˆ— */
  .user-info {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 20px;
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 0.9rem;
  }

  .user-badge {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 4px 10px;
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    color: var(--accent);
  }

  .user-label { color: var(--text2); }
  .course-count { margin-left: auto; color: var(--text2); font-size: 0.8rem; }

  /* æœˆä»½å°èˆª */
  .month-nav {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
  }

  .month-title {
    font-size: 1.2rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    flex: 1;
    text-align: center;
  }

  .nav-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    color: var(--text2);
    width: 36px; height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1rem;
  }
  .nav-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* æœˆä»½è·³è½‰æŒ‰éˆ• */
  .month-tabs {
    display: flex;
    gap: 6px;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .month-tab {
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 0.8rem;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--surface);
    color: var(--text2);
    transition: all 0.2s;
  }
  .month-tab:hover { border-color: var(--accent); color: var(--accent); }
  .month-tab.active { background: var(--accent); border-color: var(--accent); color: white; }
  .month-tab.has-course { border-color: #4f8ef760; }

  /* æœˆæ›† */
  .calendar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 28px;
  }

  .cal-header {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }

  .cal-header-cell {
    text-align: center;
    padding: 10px 4px;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text3);
    letter-spacing: 0.05em;
  }

  .cal-header-cell:first-child { color: #ef4444; }
  .cal-header-cell:last-child { color: #60a5fa; }

  .cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
  }

  .cal-cell {
    border-right: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    min-height: 90px;
    padding: 8px;
    position: relative;
    transition: background 0.15s;
  }

  .cal-cell:nth-child(7n) { border-right: none; }
  .cal-cell.empty { background: transparent; }
  .cal-cell.sunday .day-num { color: #ef4444; }
  .cal-cell.saturday .day-num { color: #60a5fa; }

  .day-num {
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text2);
    margin-bottom: 4px;
    display: block;
  }

  .cal-cell.today { background: rgba(79,142,247,0.06); }
  .cal-cell.today .day-num {
    background: var(--accent);
    color: white;
    width: 22px; height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75rem;
  }

  /* èª²ç¨‹æ¨™ç±¤ */
  .course-tag {
    display: block;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 0.68rem;
    line-height: 1.4;
    margin-bottom: 2px;
    cursor: default;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  /* ä¸åŒèª²ç¨‹é¡è‰² */
  .c0 { background: rgba(79,142,247,0.2); color: #93c5fd; border-left: 2px solid #4f8ef7; }
  .c1 { background: rgba(124,58,237,0.2); color: #c4b5fd; border-left: 2px solid #7c3aed; }
  .c2 { background: rgba(34,197,94,0.2); color: #86efac; border-left: 2px solid #22c55e; }
  .c3 { background: rgba(245,158,11,0.2); color: #fcd34d; border-left: 2px solid #f59e0b; }
  .c4 { background: rgba(239,68,68,0.2); color: #fca5a5; border-left: 2px solid #ef4444; }
  .c5 { background: rgba(20,184,166,0.2); color: #5eead4; border-left: 2px solid #14b8a6; }
  .c6 { background: rgba(236,72,153,0.2); color: #f9a8d4; border-left: 2px solid #ec4899; }
  .c7 { background: rgba(234,179,8,0.2); color: #fef08a; border-left: 2px solid #eab308; }
  .c8 { background: rgba(249,115,22,0.2); color: #fdba74; border-left: 2px solid #f97316; }
  .c9 { background: rgba(99,102,241,0.2); color: #a5b4fc; border-left: 2px solid #6366f1; }
  .c10 { background: rgba(16,185,129,0.2); color: #6ee7b7; border-left: 2px solid #10b981; }
  .c11 { background: rgba(217,70,239,0.2); color: #e879f9; border-left: 2px solid #d946ef; }

  .more-tag {
    font-size: 0.65rem;
    color: var(--text3);
    padding: 1px 4px;
    cursor: pointer;
  }
  .more-tag:hover { color: var(--accent); }

  /* åœ–ä¾‹ */
  .legend {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px 20px;
    margin-bottom: 24px;
  }

  .legend-title {
    font-size: 0.8rem;
    color: var(--text3);
    margin-bottom: 12px;
    letter-spacing: 0.05em;
    text-transform: uppercase;
  }

  .legend-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 8px;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.78rem;
    color: var(--text2);
  }

  .legend-dot {
    width: 10px; height: 10px;
    border-radius: 2px;
    flex-shrink: 0;
  }

  /* èª²ç¨‹åˆ—è¡¨ */
  .course-list {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 12px;
    overflow: hidden;
  }

  .course-list-title {
    padding: 14px 20px;
    font-size: 0.85rem;
    font-weight: 500;
    color: var(--text2);
    border-bottom: 1px solid var(--border);
    background: var(--surface2);
    letter-spacing: 0.04em;
  }

  .course-list-item {
    display: flex;
    align-items: flex-start;
    gap: 14px;
    padding: 12px 20px;
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  .course-list-item:last-child { border-bottom: none; }
  .course-list-item:hover { background: var(--surface2); }

  .course-date-badge {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 6px 10px;
    text-align: center;
    min-width: 56px;
    flex-shrink: 0;
  }

  .course-date-month { font-size: 0.65rem; color: var(--text3); }
  .course-date-day {
    font-family: 'DM Mono', monospace;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text);
    line-height: 1;
  }

  .course-info { flex: 1; }
  .course-name { font-size: 0.85rem; font-weight: 500; margin-bottom: 3px; }
  .course-meta { font-size: 0.75rem; color: var(--text2); }

  .dot-indicator {
    width: 8px; height: 8px;
    border-radius: 50%;
    margin-top: 4px;
    flex-shrink: 0;
  }

  /* ç©ºç‹€æ…‹ */
  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--text3);
  }

  .empty-icon { font-size: 2.5rem; margin-bottom: 12px; }
  .empty-text { font-size: 0.9rem; }

  /* å½™ç¸½æ¨¡å¼çš„äººå“¡æ•¸ */
  .summary-count {
    font-size: 0.7rem;
    color: var(--text3);
    background: var(--surface2);
    border-radius: 3px;
    padding: 1px 4px;
    margin-left: 2px;
  }

  @media (max-width: 600px) {
    .cal-cell { min-height: 60px; padding: 4px; }
    .course-tag { font-size: 0.6rem; }
    h1 { font-size: 1.3rem; }
  }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“… èª²ç¨‹å®‰æ’æœˆæ›†</h1>
  <p class="subtitle">è¼¸å…¥å€‹äººä»£ç¢¼æŸ¥è©¢èª²ç¨‹ï¼Œè¼¸å…¥ 000000 é¡¯ç¤ºå…¨é«”å½™ç¸½</p>

  <div class="search-box">
    <input type="text" id="codeInput" placeholder="è¼¸å…¥ä»£ç¢¼ï¼ˆä¾‹ï¼š956502ï¼‰" maxlength="10">
    <button class="btn btn-primary" onclick="search()">æŸ¥è©¢</button>
    <button class="btn btn-all" onclick="searchAll()">å…¨é«”å½™ç¸½</button>
  </div>

  <div id="userInfo" style="display:none"></div>

  <div id="main" style="display:none">
    <div class="month-tabs" id="monthTabs"></div>
    <div class="month-nav">
      <button class="nav-btn" onclick="changeMonth(-1)">â—€</button>
      <div class="month-title" id="monthTitle"></div>
      <button class="nav-btn" onclick="changeMonth(1)">â–¶</button>
    </div>
    <div class="calendar">
      <div class="cal-header">
        <div class="cal-header-cell">æ—¥</div>
        <div class="cal-header-cell">ä¸€</div>
        <div class="cal-header-cell">äºŒ</div>
        <div class="cal-header-cell">ä¸‰</div>
        <div class="cal-header-cell">å››</div>
        <div class="cal-header-cell">äº”</div>
        <div class="cal-header-cell">å…­</div>
      </div>
      <div class="cal-grid" id="calGrid"></div>
    </div>

    <div class="legend">
      <div class="legend-title">èª²ç¨‹åœ–ä¾‹</div>
      <div class="legend-grid" id="legendGrid"></div>
    </div>

    <div class="course-list">
      <div class="course-list-title" id="listTitle">èª²ç¨‹æ¸…å–®</div>
      <div id="courseList"></div>
    </div>
  </div>

  <div id="emptyState" class="empty-state" style="display:none">
    <div class="empty-icon">ğŸ”</div>
    <div class="empty-text">æ‰¾ä¸åˆ°æ­¤ä»£ç¢¼ï¼Œè«‹ç¢ºèªå¾Œå†è©¦</div>
  </div>
</div>

<script>
// ===== è³‡æ–™ =====
const COURSE_NAMES = [
  'è·æ¥­å®‰å…¨è¡›ç”Ÿç®¡ç†å“¡',
  'è·æ¥­å®‰å…¨è¡›ç”Ÿæ¥­å‹™ä¸»ç®¡',
  'ä¸€èˆ¬å®‰å…¨è¡›ç”Ÿåœ¨è·æ•™è‚²è¨“ç·´',
  'å±å®³é€šè­˜',
  'å±€é™ç©ºé–“ä½œæ¥­äººå“¡',
  'æ€¥æ•‘äººå“¡',
  'æœ‰æ©Ÿæº¶åŠ‘ä½œæ¥­ä¸»ç®¡',
  'ç¼ºæ°§ä½œæ¥­ä¸»ç®¡',
  'æ–½å·¥æ¶çµ„é…ä½œæ¥­ä¸»ç®¡',
  'è·é‡ä¸€å…¬å™¸ä»¥ä¸Šå †é«˜æ©Ÿæ“ä½œäººå“¡',
  'èµ·é‡æ©ŸåŠåŠæ›æ“ä½œäººå“¡',
  'ç¬¬ä¸€ç¨®å£“åŠ›å®¹å™¨æ“ä½œäººå“¡è¨“ç·´æš¨é‹çˆæ“ä½œäººå“¡'
];

// åŸå§‹è³‡æ–™ï¼š[ä»£ç¢¼, èª²ç¨‹1æ—¥æœŸ, èª²ç¨‹2æ—¥æœŸ, ...]  (null = ä¸éœ€ä¸Šèª²)
const RAW_DATA = [
  [956502, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, null, null, null, '8/4 (ä¸Šåˆ)', null],
  [919959, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, null, null, null, '8/11 (ä¸Šåˆ)', null],
  [926927, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, '7/24 (ä¸€å¤©)', null, null, '8/4 (ä¸Šåˆ)', null],
  [926865, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/23 (ä¸Šåˆ)', '9/1 (ä¸‹åˆ)', null, '7/24 (ä¸€å¤©)', '7/13 (ä¸€å¤©)', null, '8/27 (ä¸Šåˆ)', null],
  [667802, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/23 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', null, '7/24 (ä¸€å¤©)', '7/6 (ä¸€å¤©)', null, '8/4 (ä¸Šåˆ)', null],
  [777829, null, '9/9 (ä¸€å¤©)', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', '7/3 (ä¸€å¤©)', '7/24 (ä¸€å¤©)', '8/3 (ä¸€å¤©)', null, '8/20 (ä¸Šåˆ)', null],
  [159297, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', null, '7/31 (ä¸€å¤©)', '7/6 (ä¸€å¤©)', null, '8/4 (ä¸Šåˆ)', null],
  [420048, null, '7/8 (ä¸€å¤©) ', '7/9 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', '7/10 (ä¸€å¤©)', '8/7 (ä¸€å¤©)', '7/6 (ä¸€å¤©)', '8/10 (ä¸Šåˆ)', '8/11 (ä¸Šåˆ)', null],
  [926826, null, '7/8 (ä¸€å¤©) ', '7/9 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/23 (ä¸Šåˆ)', null, null, '7/24 (ä¸€å¤©)', null, '8/10 (ä¸Šåˆ)', '8/6 (ä¸Šåˆ)', null],
  [813927, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', null, '7/24 (ä¸€å¤©)', '7/6 (ä¸€å¤©)', '8/10 (ä¸Šåˆ)', '8/4 (ä¸Šåˆ)', null],
  [667725, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', null, '7/24 (ä¸€å¤©)', null, '8/10 (ä¸Šåˆ)', '8/6 (ä¸Šåˆ)', null],
  [969081, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, null, null, null, null, null],
  [420099, null, '7/15 (ä¸€å¤©)', '7/9 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/23 (ä¸Šåˆ)', '8/31 (ä¸‹åˆ)', null, '7/24 (ä¸€å¤©)', '8/3 (ä¸€å¤©)', null, '8/13 (ä¸Šåˆ)', null],
  [485918, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸‹åˆ)', null, null, null, null, null, null],
  [441802, null, '7/15 (ä¸€å¤©)', '7/9 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', '7/10 (ä¸€å¤©)', '7/24 (ä¸€å¤©)', '7/20 (ä¸€å¤©)', '8/17 (ä¸Šåˆ)', null, null],
  [438515, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', '7/10 (ä¸€å¤©)', '7/24 (ä¸€å¤©)', '7/6 (ä¸€å¤©)', null, null, null],
  [667903, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/16 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, null, null, '8/14 (ä¸Šåˆ)', null, null],
  [535474, null, null, '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, null, null, null, null, null],
  [958658, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', null, null, '7/24 (ä¸€å¤©)', null, null, '8/4 (ä¸Šåˆ)', null],
  [271003, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', '7/17 (ä¸€å¤©)', '7/24 (ä¸€å¤©)', '7/20 (ä¸€å¤©)', null, '8/27 (ä¸Šåˆ)', null],
  [995225, null, '8/5 (ä¸€å¤©)', '7/7 (ä¸Šåˆ)', null, '7/21 (ä¸Šåˆ)', null, null, null, null, null, null, null],
  [926941, null, '7/8 (ä¸€å¤©) ', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/21 (ä¸Šåˆ)', '8/31 (ä¸Šåˆ)', null, null, null, '8/21 (ä¸Šåˆ)', '8/4 (ä¸Šåˆ)', null],
  [121172, null, '7/22 (ä¸€å¤©)', '7/7 (ä¸Šåˆ)', '7/14 (ä¸Šåˆ)', '7/23 (ä¸Šåˆ)', '8/31 (ä¸‹åˆ)', null, '7/24 (ä¸€å¤©)', '7/13 (ä¸€å¤©)', null, '8/4 (ä¸Šåˆ)', null],
];

// ===== è§£ææ—¥æœŸ =====
function parseDate(str, year = 2026) {
  if (!str) return null;
  str = str.trim();
  const m = str.match(/(\d+)\/(\d+)/);
  if (!m) return null;
  return { month: parseInt(m[1]), day: parseInt(m[2]), year, label: str };
}

// å»ºç«‹ç´¢å¼•ï¼šcode -> [{month, day, year, courseIdx, label}]
function buildIndex() {
  const idx = {};
  for (const row of RAW_DATA) {
    const code = String(Math.round(row[0]));
    const entries = [];
    for (let c = 1; c < 13; c++) {
      const val = row[c];
      if (val) {
        const d = parseDate(val);
        if (d) {
          d.courseIdx = c - 1;
          d.courseName = COURSE_NAMES[c - 1];
          entries.push(d);
        }
      }
    }
    idx[code] = entries;
  }
  return idx;
}

const DATA_INDEX = buildIndex();

// ===== ç‹€æ…‹ =====
let currentCode = '';
let currentEntries = [];
let currentYear = 2026;
let currentMonth = 7;
let allMonths = [];

// ===== ä¸»æµç¨‹ =====
function search() {
  const code = document.getElementById('codeInput').value.trim();
  if (!code) return;
  if (code === '000000') { searchAll(); return; }

  if (!DATA_INDEX[code]) {
    document.getElementById('main').style.display = 'none';
    document.getElementById('userInfo').style.display = 'none';
    document.getElementById('emptyState').style.display = 'block';
    return;
  }

  currentCode = code;
  currentEntries = DATA_INDEX[code];
  showCalendar(false);
}

function searchAll() {
  currentCode = '000000';
  // åˆä½µæ‰€æœ‰äººè³‡æ–™ï¼Œä¿ç•™ code è³‡è¨Š
  const all = [];
  for (const [code, entries] of Object.entries(DATA_INDEX)) {
    for (const e of entries) {
      all.push({ ...e, code });
    }
  }
  currentEntries = all;
  showCalendar(true);
}

document.getElementById('codeInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') search();
});

function showCalendar(isAll) {
  document.getElementById('emptyState').style.display = 'none';
  document.getElementById('main').style.display = 'block';

  // ä½¿ç”¨è€…è³‡è¨Š
  const info = document.getElementById('userInfo');
  info.style.display = 'flex';
  if (isAll) {
    info.innerHTML = `<span class="user-badge">000000</span><span class="user-label">å…¨é«”å½™ç¸½æ¨¡å¼</span><span class="course-count">${Object.keys(DATA_INDEX).length} äººãƒ»å…± ${currentEntries.length} ç­†èª²ç¨‹</span>`;
  } else {
    info.innerHTML = `<span class="user-badge">${currentCode}</span><span class="user-label">å€‹äººèª²ç¨‹</span><span class="course-count">å…± ${currentEntries.length} ç­†èª²ç¨‹</span>`;
  }

  // æ‰¾å‡ºæ‰€æœ‰æ¶‰åŠæœˆä»½
  const monthSet = new Set(currentEntries.map(e => `${e.year}-${e.month}`));
  allMonths = [...monthSet].sort().map(s => {
    const [y, m] = s.split('-');
    return { year: parseInt(y), month: parseInt(m) };
  });

  if (allMonths.length > 0) {
    currentYear = allMonths[0].year;
    currentMonth = allMonths[0].month;
  }

  renderMonthTabs();
  renderCalendar();
  renderLegend();
  renderList();
}

function renderMonthTabs() {
  const tabs = document.getElementById('monthTabs');
  const MONTHS = ['ä¸€æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','åä¸€æœˆ','åäºŒæœˆ'];
  tabs.innerHTML = allMonths.map(({year, month}) => {
    const active = year === currentYear && month === currentMonth;
    return `<button class="month-tab ${active ? 'active' : 'has-course'}" onclick="goMonth(${year},${month})">${month}æœˆ</button>`;
  }).join('');
}

function goMonth(y, m) {
  currentYear = y;
  currentMonth = m;
  renderMonthTabs();
  renderCalendar();
  renderList();
}

function changeMonth(delta) {
  let m = currentMonth + delta;
  let y = currentYear;
  if (m < 1) { m = 12; y--; }
  if (m > 12) { m = 1; y++; }
  currentMonth = m; currentYear = y;
  renderMonthTabs();
  renderCalendar();
  renderList();
}

// ===== æ¸²æŸ“æœˆæ›† =====
function renderCalendar() {
  const MONTHS = ['ä¸€æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','åä¸€æœˆ','åäºŒæœˆ'];
  document.getElementById('monthTitle').textContent = `${currentYear} å¹´ ${MONTHS[currentMonth-1]}`;

  const firstDay = new Date(currentYear, currentMonth - 1, 1).getDay();
  const daysInMonth = new Date(currentYear, currentMonth, 0).getDate();
  const today = new Date();

  // ç•¶æœˆèª²ç¨‹ grouped by day
  const dayMap = {};
  for (const e of currentEntries) {
    if (e.month === currentMonth && e.year === currentYear) {
      const key = e.day;
      if (!dayMap[key]) dayMap[key] = [];
      dayMap[key].push(e);
    }
  }

  const grid = document.getElementById('calGrid');
  grid.innerHTML = '';

  // ç©ºæ ¼
  for (let i = 0; i < firstDay; i++) {
    grid.innerHTML += `<div class="cal-cell empty"></div>`;
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const isToday = today.getFullYear() === currentYear && today.getMonth() + 1 === currentMonth && today.getDate() === d;
    const dow = new Date(currentYear, currentMonth - 1, d).getDay();
    const cls = ['cal-cell', dow === 0 ? 'sunday' : '', dow === 6 ? 'saturday' : '', isToday ? 'today' : ''].filter(Boolean).join(' ');

    const courses = dayMap[d] || [];
    let coursesHTML = '';
    const MAX_SHOW = 3;

    // å½™ç¸½æ¨¡å¼ï¼šæ¯å€‹èª²ç¨‹èšåˆ
    if (currentCode === '000000') {
      const courseGroups = {};
      for (const e of courses) {
        if (!courseGroups[e.courseIdx]) courseGroups[e.courseIdx] = 0;
        courseGroups[e.courseIdx]++;
      }
      const keys = Object.keys(courseGroups);
      const show = keys.slice(0, MAX_SHOW);
      for (const k of show) {
        const cnt = courseGroups[k];
        coursesHTML += `<span class="course-tag c${parseInt(k) % 12}" title="${COURSE_NAMES[k]}">${COURSE_NAMES[k].substring(0,5)}<span class="summary-count">${cnt}</span></span>`;
      }
      if (keys.length > MAX_SHOW) coursesHTML += `<span class="more-tag">+${keys.length - MAX_SHOW} æ›´å¤š</span>`;
    } else {
      const show = courses.slice(0, MAX_SHOW);
      for (const e of show) {
        const timeLabel = e.label.includes('ä¸Šåˆ') ? 'ä¸Š' : e.label.includes('ä¸‹åˆ') ? 'ä¸‹' : 'å…¨';
        coursesHTML += `<span class="course-tag c${e.courseIdx % 12}" title="${e.courseName} ${e.label}">${e.courseName.substring(0,4)} <small>${timeLabel}</small></span>`;
      }
      if (courses.length > MAX_SHOW) coursesHTML += `<span class="more-tag">+${courses.length - MAX_SHOW} æ›´å¤š</span>`;
    }

    grid.innerHTML += `<div class="${cls}"><span class="day-num">${d}</span>${coursesHTML}</div>`;
  }
}

// ===== æ¸²æŸ“åœ–ä¾‹ =====
function renderLegend() {
  const usedIdx = new Set(currentEntries.map(e => e.courseIdx));
  const colors = ['#4f8ef7','#7c3aed','#22c55e','#f59e0b','#ef4444','#14b8a6','#ec4899','#eab308','#f97316','#6366f1','#10b981','#d946ef'];
  const lg = document.getElementById('legendGrid');
  lg.innerHTML = [...usedIdx].sort((a,b)=>a-b).map(idx => `
    <div class="legend-item">
      <div class="legend-dot" style="background:${colors[idx%12]}"></div>
      <span>${COURSE_NAMES[idx]}</span>
    </div>
  `).join('');
}

// ===== æ¸²æŸ“åˆ—è¡¨ =====
function renderList() {
  const MONTHS = ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
  const colors = ['#4f8ef7','#7c3aed','#22c55e','#f59e0b','#ef4444','#14b8a6','#ec4899','#eab308','#f97316','#6366f1','#10b981','#d946ef'];

  // ç•¶æœˆèª²ç¨‹æ’åº
  const monthEntries = currentEntries
    .filter(e => e.month === currentMonth && e.year === currentYear)
    .sort((a, b) => a.day - b.day || a.courseIdx - b.courseIdx);

  document.getElementById('listTitle').textContent = `${currentMonth}æœˆ èª²ç¨‹æ¸…å–®ï¼ˆ${monthEntries.length} ç­†ï¼‰`;

  const list = document.getElementById('courseList');
  if (monthEntries.length === 0) {
    list.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ“­</div><div class="empty-text">æœ¬æœˆç„¡èª²ç¨‹</div></div>`;
    return;
  }

  if (currentCode === '000000') {
    // å½™ç¸½ï¼šæŒ‰æ—¥æœŸåˆ†çµ„é¡¯ç¤º
    const dayGroups = {};
    for (const e of monthEntries) {
      if (!dayGroups[e.day]) dayGroups[e.day] = {};
      if (!dayGroups[e.day][e.courseIdx]) dayGroups[e.day][e.courseIdx] = { ...e, count: 0, codes: [] };
      dayGroups[e.day][e.courseIdx].count++;
      dayGroups[e.day][e.courseIdx].codes.push(e.code);
    }

    let html = '';
    for (const day of Object.keys(dayGroups).sort((a,b)=>a-b)) {
      for (const ci of Object.keys(dayGroups[day]).sort((a,b)=>a-b)) {
        const e = dayGroups[day][ci];
        html += `<div class="course-list-item">
          <div class="course-date-badge">
            <div class="course-date-month">${MONTHS[e.month-1]}</div>
            <div class="course-date-day">${e.day}</div>
          </div>
          <div class="course-info">
            <div class="course-name">${e.courseName}</div>
            <div class="course-meta">${e.label} ãƒ» ${e.count} äººåƒåŠ </div>
          </div>
          <div class="dot-indicator" style="background:${colors[parseInt(ci)%12]}"></div>
        </div>`;
      }
    }
    list.innerHTML = html;
  } else {
    list.innerHTML = monthEntries.map(e => `
      <div class="course-list-item">
        <div class="course-date-badge">
          <div class="course-date-month">${MONTHS[e.month-1]}</div>
          <div class="course-date-day">${e.day}</div>
        </div>
        <div class="course-info">
          <div class="course-name">${e.courseName}</div>
          <div class="course-meta">${e.label}</div>
        </div>
        <div class="dot-indicator" style="background:${colors[e.courseIdx%12]}"></div>
      </div>
    `).join('');
  }
}

// é è¨­é¡¯ç¤ºå…¨é«”å½™ç¸½
searchAll();
document.getElementById('codeInput').value = '';
</script>
</body>
</html>
